# Collaborative Filtering - Visual Flow Diagram

## ğŸ”„ How Your Recommendation System Works Now

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER REQUESTS RECOMMENDATIONS                â”‚
â”‚                    GET /api/recommendations/movies                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HYBRID RECOMMENDATION  â”‚
                    â”‚       SYSTEM            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚                â”‚
                â–¼                â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CONTENT-    â”‚ â”‚ COLLABORATIVEâ”‚ â”‚  MOOD-BASED  â”‚
        â”‚    BASED     â”‚ â”‚  FILTERING   â”‚ â”‚  (Optional)  â”‚
        â”‚   (40%)      â”‚ â”‚    (30%)     â”‚ â”‚    (30%)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                â”‚                â”‚
               â”‚                â–¼                â”‚
               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
               â”‚    â”‚ Cosine Similarity CF â”‚    â”‚
               â”‚    â”‚  (NEW & IMPROVED!)   â”‚    â”‚
               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
               â”‚                â”‚                â”‚
               â”‚                â–¼                â”‚
               â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
               â”‚         â”‚ Enough     â”‚          â”‚
               â”‚         â”‚ Data?      â”‚          â”‚
               â”‚         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
               â”‚               â”‚                 â”‚
               â”‚         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           â”‚
               â”‚         â”‚           â”‚           â”‚
               â”‚      YESâ”‚           â”‚NO         â”‚
               â”‚         â”‚           â”‚           â”‚
               â”‚         â–¼           â–¼           â”‚
               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
               â”‚    â”‚  CF    â”‚  â”‚Fallbackâ”‚      â”‚
               â”‚    â”‚Results â”‚  â”‚(Empty) â”‚      â”‚
               â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜      â”‚
               â”‚         â”‚           â”‚           â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  COMBINE WITH   â”‚
                â”‚    WEIGHTS      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  SORT BY SCORE  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  RETURN TOP 20  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Pure Collaborative Filtering Flow

```
USER REQUEST
â”‚
â”œâ”€ GET /api/recommendations/collaborative/movies
â”‚
â””â”€â–¶ collaborativeFilteringService.js
    â”‚
    â”œâ”€ STEP 1: Load All User Interactions
    â”‚   â”‚
    â”‚   â””â”€â–¶ UserInteraction.find({ itemType: "movie", interactionType: "like" })
    â”‚       Result: All user-movie likes
    â”‚
    â”œâ”€ STEP 2: Build User-Item Matrix
    â”‚   â”‚
    â”‚   â””â”€â–¶ Map<userId, Set<itemIds>>
    â”‚       Example:
    â”‚       User1 â†’ {Movie1, Movie2, Movie5}
    â”‚       User2 â†’ {Movie1, Movie3, Movie4}
    â”‚       User3 â†’ {Movie2, Movie5, Movie6}
    â”‚
    â”œâ”€ STEP 3: Calculate Similarities
    â”‚   â”‚
    â”‚   â””â”€â–¶ For each other user:
    â”‚       â”‚
    â”‚       â”œâ”€ Check overlap (fast gate)
    â”‚       â”‚  If overlap < minOverlap â†’ skip
    â”‚       â”‚
    â”‚       â””â”€ Calculate Cosine Similarity
    â”‚          similarity = commonItems / âˆš(userA.size Ã— userB.size)
    â”‚          Example: User1 â†” User2
    â”‚          Common: {Movie1} = 1 item
    â”‚          Size: âˆš(3 Ã— 3) = 3
    â”‚          Similarity: 1/3 = 0.33
    â”‚
    â”œâ”€ STEP 4: Get Top-K Neighbors
    â”‚   â”‚
    â”‚   â””â”€â–¶ Sort by similarity, take top 30
    â”‚       [
    â”‚         { userId: User3, similarity: 0.87, overlap: 2 },
    â”‚         { userId: User2, similarity: 0.33, overlap: 1 },
    â”‚         ...
    â”‚       ]
    â”‚
    â”œâ”€ STEP 5: Aggregate Recommendations
    â”‚   â”‚
    â”‚   â””â”€â–¶ For each neighbor:
    â”‚       â”‚
    â”‚       â”œâ”€ Get items they liked (not in target user's likes)
    â”‚       â”‚  User3 liked: Movie6 (not seen by User1)
    â”‚       â”‚
    â”‚       â””â”€ Add similarity weight to item score
    â”‚          Movie6.score += 0.87
    â”‚
    â”œâ”€ STEP 6: Sort & Fetch Movies
    â”‚   â”‚
    â”‚   â”œâ”€â–¶ Sort items by total score
    â”‚   â”‚   Movie6: 0.87
    â”‚   â”‚   Movie3: 0.33
    â”‚   â”‚   Movie4: 0.33
    â”‚   â”‚
    â”‚   â””â”€â–¶ Movie.find({ _id: { $in: [Movie6, Movie3, Movie4] } })
    â”‚
    â””â”€ STEP 7: Return Results
        {
          recommendations: [ /* movie objects with scores */ ],
          neighbors: [ /* top similar users */ ],
          stats: { /* analytics */ }
        }
```

---

## ğŸ§® Cosine Similarity Calculation - Visual Example

```
Target User (You):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Liked: [Movie1, Movie2, Movie3]     â”‚
â”‚ Count: 3 movies                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Other User (Alice):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Liked: [Movie1, Movie2, Movie4, M5] â”‚
â”‚ Count: 4 movies                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Find Intersection
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Common: [Movie1, Movie2]             â”‚
â”‚ Count: 2 movies                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Calculate Cosine Similarity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Formula:                             â”‚
â”‚ similarity = |A âˆ© B| / âˆš(|A| Ã— |B|) â”‚
â”‚                                      â”‚
â”‚ similarity = 2 / âˆš(3 Ã— 4)            â”‚
â”‚ similarity = 2 / âˆš12                 â”‚
â”‚ similarity = 2 / 3.46                â”‚
â”‚ similarity = 0.58                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Interpretation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.58 = Moderately Similar            â”‚
â”‚                                      â”‚
â”‚ 0.0 - 0.3  â†’ Low similarity          â”‚
â”‚ 0.3 - 0.6  â†’ Moderate similarity     â”‚
â”‚ 0.6 - 1.0  â†’ High similarity         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Alice's recommendations weighted by 0.58:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Movie4: score = 0.58                 â”‚
â”‚ Movie5: score = 0.58                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Fallback Strategy Flow

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ CF Recommendation   â”‚
                  â”‚    Requested        â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â”€â”¤  Has User      â”œâ”€â”€â”€â”€â”€â”
              â”‚     â”‚  Liked Items?  â”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
             NO                           YES
              â”‚                             â”‚
              â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return Empty    â”‚        â”‚ Find Similar     â”‚
    â”‚  Reason: Cold    â”‚        â”‚ Users            â”‚
    â”‚  Start           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                             â–¼
             â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚              â”Œâ”€â”€â”€â”€â”€â”¤ Similar Users  â”œâ”€â”€â”€â”€â”€â”
             â”‚              â”‚     â”‚ Found?         â”‚     â”‚
             â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
             â”‚             NO                           YES
             â”‚              â”‚                             â”‚
             â”‚              â–¼                             â–¼
             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    â”‚  Return Empty    â”‚        â”‚ Generate CF      â”‚
             â”‚    â”‚  Reason: No      â”‚        â”‚ Recommendations  â”‚
             â”‚    â”‚  Similar Users   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚             â”‚                             â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”€â”€â”¤ Has CF Results?â”œâ”€â”€â”€â”€â”€â”
            â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
           NO                           YES
            â”‚                             â”‚
            â–¼                             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ FALLBACK:        â”‚          â”‚ Return CF        â”‚
  â”‚ Call Content-    â”‚          â”‚ Recommendations  â”‚
  â”‚ Based System     â”‚          â”‚ + Stats          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Return Content-  â”‚
  â”‚ Based Results    â”‚
  â”‚ Source: Fallback â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Audit Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Run Audit       â”‚
                    â”‚ Endpoint        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â”€â”¤ Users >= 10?   â”œâ”€â”€â”€â”€â”€â”
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
             NO                           YES
              â”‚                             â”‚
              â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âŒ NOT VIABLE    â”‚    â”Œâ”€â”€â”€â”€â”€â”¤ Avg Likes >= 3?â”œâ”€â”€â”€â”€â”€â”
    â”‚                  â”‚    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚ Recommendation:  â”‚   NO                           YES
    â”‚ â€¢ Add more users â”‚    â”‚                             â”‚
    â”‚ â€¢ Use content-   â”‚    â–¼                             â–¼
    â”‚   based only     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ âš ï¸ MARGINAL     â”‚  â”‚ âœ… VIABLE        â”‚
                          â”‚                  â”‚  â”‚                  â”‚
                          â”‚ Recommendation:  â”‚  â”‚ Recommendation:  â”‚
                          â”‚ â€¢ Encourage more â”‚  â”‚ â€¢ CF will work   â”‚
                          â”‚   interactions   â”‚  â”‚ â€¢ Monitor stats  â”‚
                          â”‚ â€¢ Lower minOver  â”‚  â”‚ â€¢ Tune params    â”‚
                          â”‚ â€¢ Use hybrid     â”‚  â”‚ â€¢ Great results! â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ Complete Request-Response Flow

```
FRONTEND
â”‚
â”œâ”€ User clicks "Get Recommendations"
â”‚
â””â”€â–¶ API Request
    â”‚
    â”œâ”€ Headers: { Authorization: "Bearer JWT_TOKEN" }
    â”‚
    â””â”€â–¶ GET /api/recommendations/collaborative/movies?k=30&limit=10
        â”‚
        â””â”€â–¶ BACKEND
            â”‚
            â”œâ”€ authMiddleware verifies JWT â†’ req.user
            â”‚
            â”œâ”€â–¶ recommendationRoutes.js
            â”‚   â”‚
            â”‚   â””â”€â–¶ getCollaborativeMovies controller
            â”‚       â”‚
            â”‚       â”œâ”€ Extract userId from req.user._id
            â”‚       â”‚
            â”‚       â”œâ”€â–¶ collaborativeFilteringService
            â”‚       â”‚   â”‚
            â”‚       â”‚   â””â”€â–¶ getCollaborativeMovieRecommendations()
            â”‚       â”‚       â”‚
            â”‚       â”‚       â”œâ”€ Load UserInteraction data
            â”‚       â”‚       â”œâ”€ Build user-item matrix
            â”‚       â”‚       â”œâ”€ Calculate similarities
            â”‚       â”‚       â”œâ”€ Find top-k neighbors
            â”‚       â”‚       â”œâ”€ Aggregate recommendations
            â”‚       â”‚       â””â”€ Return results
            â”‚       â”‚
            â”‚       â”œâ”€ Check if results.length > 0
            â”‚       â”‚
            â”‚       â”œâ”€ If YES â†’ Return CF results
            â”‚       â”‚
            â”‚       â””â”€ If NO â†’ Fallback
            â”‚           â”‚
            â”‚           â””â”€â–¶ recommendationService
            â”‚               â”‚
            â”‚               â””â”€â–¶ getMovieRecommendations()
            â”‚                   â”‚
            â”‚                   â””â”€ Return content-based
            â”‚
            â””â”€â–¶ RESPONSE
                {
                  "success": true,
                  "source": "collaborative_filtering",
                  "data": {
                    "recommendations": [...],
                    "neighbors": [...],
                    "stats": {...}
                  }
                }
```

---

## ğŸ¯ Key Decision Points

### **1. When to Use CF vs Content-Based?**

```
Start Here
â”‚
â”œâ”€ New User? â†’ Content-Based
â”‚
â”œâ”€ User has < 3 likes? â†’ Content-Based
â”‚
â”œâ”€ System has < 10 users? â†’ Content-Based
â”‚
â”œâ”€ No similar users found? â†’ Content-Based
â”‚
â””â”€ Otherwise â†’ Collaborative Filtering!
```

### **2. Which Similarity Metric?**

```
Dataset Characteristics
â”‚
â”œâ”€ Users have similar activity levels? â†’ Jaccard
â”‚
â”œâ”€ Users have vastly different activity? â†’ Cosine âœ…
â”‚
â”œâ”€ Sparse data? â†’ Cosine âœ…
â”‚
â””â”€ Dense data with ratings? â†’ Pearson Correlation
```

### **3. How to Tune k (neighbors)?**

```
Data Size
â”‚
â”œâ”€ < 50 users? â†’ k = 10-20
â”‚
â”œâ”€ 50-500 users? â†’ k = 20-40 âœ… (Your case)
â”‚
â”œâ”€ 500-5000 users? â†’ k = 40-100
â”‚
â””â”€ > 5000 users? â†’ k = 100-200, consider caching
```

---

## ğŸ“ˆ Performance Characteristics

```
Number of Users:     10      50      100     500     1000
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Query Time (ms):     50      120     200     800     2000
Memory (MB):         5       15      30      150     500
Recommendations:     Poor    Good    Great   Great   Great
Fallback Rate:       High    Med     Low     Low     Very Low
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Recommendation:
< 100 users   â†’ Real-time CF (current implementation)
100-1000 users â†’ Consider caching popular users
> 1000 users  â†’ Pre-compute and cache all recommendations
```

---

## ğŸ” Monitoring Dashboard (What to Track)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CF HEALTH DASHBOARD                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Total Users:              156                          â”‚
â”‚  Users with Interactions:  134  (85%)                   â”‚
â”‚  Avg Interactions/User:    7.2                          â”‚
â”‚                                                         â”‚
â”‚  CF Success Rate:          78%  âœ…                      â”‚
â”‚  Fallback Rate:            22%  âš ï¸                      â”‚
â”‚                                                         â”‚
â”‚  Avg Similar Users Found:  23                           â”‚
â”‚  Avg Recommendation Score: 0.65                         â”‚
â”‚                                                         â”‚
â”‚  Response Time (avg):      145ms âœ…                     â”‚
â”‚  Response Time (p95):      320ms âš ï¸                     â”‚
â”‚                                                         â”‚
â”‚  Status: HEALTHY           Last Updated: 2min ago      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Use these diagrams to understand the flow and debug issues!** ğŸ“
